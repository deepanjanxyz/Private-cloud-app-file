name: Build APK Manually
on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # ১. কোড চেকআউট (অফিসিয়াল)
      - uses: actions/checkout@v4

      # ২. জাভা সেটআপ (অ্যান্ড্রয়েড বিল্ডের জন্য জরুরি)
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # ৩. পাইথন সেটআপ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # ৪. বিল্ডোজার এবং প্রয়োজনীয় সব টুল ম্যানুয়ালি ইন্সটল
      - name: Install Buildozer & Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential git libffi-dev libssl-dev python3-dev autoconf libtool pkg-config zlib1g-dev libncurses5-dev libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev
          pip install --upgrade pip
          pip install buildozer cython==0.29.36 kivy

      # ৫. পারমিশন ঠিক করা (অনেক সময় এটা নিয়ে ঝামেলা হয়)
      - name: Fix permissions
        run: chmod +x main.py

      # ৬. আসল বিল্ড কমান্ড (Yes কমান্ড দিয়ে অটোমেটিক সব মেনে নেওয়া হবে)
      - name: Build APK
        run: yes | buildozer android debug

      # ৭. ফাইল আপলোড (আগেরবার এখানে ভুল ছিল, এটা সঠিক ভার্সন)
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: monster-cloud-app
          path: bin/*.apk
